{"ast":null,"code":"var _jsxFileName = \"D:\\\\Personal_Projects\\\\Vehicle Tracking\\\\Development2.0\\\\JFRD-ULTRAKER\\\\traccar-web\\\\modern\\\\src\\\\reports\\\\ReplayPage.js\";\nimport React, { useState } from 'react';\nimport { Accordion, AccordionDetails, AccordionSummary, Container, makeStyles, Paper, Slider, Tooltip, Typography } from '@material-ui/core';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport MainToolbar from '../MainToolbar';\nimport Map from '../map/Map';\nimport t from '../common/localization';\nimport ReplayPathMap from '../map/ReplayPathMap';\nimport PositionsMap from '../map/PositionsMap';\nimport { formatPosition } from '../common/formatter';\nimport ReportFilter from './ReportFilter';\nconst useStyles = makeStyles(theme => ({\n  root: {\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  controlPanel: {\n    position: 'absolute',\n    bottom: theme.spacing(5),\n    left: '50%',\n    transform: 'translateX(-50%)'\n  },\n  controlContent: {\n    padding: theme.spacing(2),\n    marginBottom: theme.spacing(2)\n  },\n  configForm: {\n    display: 'flex',\n    flexDirection: 'column'\n  }\n}));\n\nconst TimeLabel = _ref => {\n  let {\n    children,\n    open,\n    value\n  } = _ref;\n  return /*#__PURE__*/React.createElement(Tooltip, {\n    open: open,\n    enterTouchDelay: 0,\n    placement: \"top\",\n    title: value,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 3\n    }\n  }, children);\n};\n\nconst ReplayPage = () => {\n  const classes = useStyles();\n  const [expanded, setExpanded] = useState(true);\n  const [positions, setPositions] = useState([]);\n  const [index, setIndex] = useState(0);\n\n  const handleSubmit = async (deviceId, from, to, _, headers) => {\n    const query = new URLSearchParams({\n      deviceId,\n      from,\n      to\n    });\n    const response = await fetch(`/api/positions?${query.toString()}`, {\n      headers\n    });\n\n    if (response.ok) {\n      setIndex(0);\n      setPositions(await response.json());\n      setExpanded(false);\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(MainToolbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(Map, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ReplayPathMap, {\n    positions: positions,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 9\n    }\n  }), index < positions.length && /*#__PURE__*/React.createElement(PositionsMap, {\n    positions: [positions[index]],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 14\n    }\n  })), /*#__PURE__*/React.createElement(Container, {\n    maxWidth: \"sm\",\n    className: classes.controlPanel,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }\n  }, !!positions.length && /*#__PURE__*/React.createElement(Paper, {\n    className: classes.controlContent,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Slider, {\n    max: positions.length - 1,\n    step: null,\n    marks: positions.map((_, index) => ({\n      value: index\n    })),\n    value: index,\n    onChange: (_, index) => setIndex(index),\n    valueLabelDisplay: \"auto\",\n    valueLabelFormat: i => i < positions.length ? formatPosition(positions[i], 'fixTime') : '',\n    ValueLabelComponent: TimeLabel,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Accordion, {\n    expanded: expanded,\n    onChange: () => setExpanded(!expanded),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(AccordionSummary, {\n    expandIcon: /*#__PURE__*/React.createElement(ExpandMoreIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 43\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    align: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 15\n    }\n  }, t('reportConfigure'))), /*#__PURE__*/React.createElement(AccordionDetails, {\n    className: classes.configForm,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(ReportFilter, {\n    handleSubmit: handleSubmit,\n    showOnly: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 15\n    }\n  }))))));\n};\n\nexport default ReplayPage;","map":{"version":3,"sources":["D:/Personal_Projects/Vehicle Tracking/Development2.0/JFRD-ULTRAKER/traccar-web/modern/src/reports/ReplayPage.js"],"names":["React","useState","Accordion","AccordionDetails","AccordionSummary","Container","makeStyles","Paper","Slider","Tooltip","Typography","ExpandMoreIcon","MainToolbar","Map","t","ReplayPathMap","PositionsMap","formatPosition","ReportFilter","useStyles","theme","root","height","display","flexDirection","controlPanel","position","bottom","spacing","left","transform","controlContent","padding","marginBottom","configForm","TimeLabel","children","open","value","ReplayPage","classes","expanded","setExpanded","positions","setPositions","index","setIndex","handleSubmit","deviceId","from","to","_","headers","query","URLSearchParams","response","fetch","toString","ok","json","length","map","i"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\r\nimport {\r\n  Accordion, AccordionDetails, AccordionSummary, Container, makeStyles, Paper, Slider, Tooltip, Typography,\r\n} from '@material-ui/core';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport MainToolbar from '../MainToolbar';\r\nimport Map from '../map/Map';\r\nimport t from '../common/localization';\r\nimport ReplayPathMap from '../map/ReplayPathMap';\r\nimport PositionsMap from '../map/PositionsMap';\r\nimport { formatPosition } from '../common/formatter';\r\nimport ReportFilter from './ReportFilter';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    height: '100%',\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n  },\r\n  controlPanel: {\r\n    position: 'absolute',\r\n    bottom: theme.spacing(5),\r\n    left: '50%',\r\n    transform: 'translateX(-50%)',\r\n  },\r\n  controlContent: {\r\n    padding: theme.spacing(2),\r\n    marginBottom: theme.spacing(2),\r\n  },\r\n  configForm: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n  },\r\n}));\r\n\r\nconst TimeLabel = ({ children, open, value }) => (\r\n  <Tooltip open={open} enterTouchDelay={0} placement=\"top\" title={value}>\r\n    {children}\r\n  </Tooltip>\r\n);\r\n\r\nconst ReplayPage = () => {\r\n  const classes = useStyles();\r\n\r\n  const [expanded, setExpanded] = useState(true);\r\n  const [positions, setPositions] = useState([]);\r\n  const [index, setIndex] = useState(0);\r\n\r\n  const handleSubmit = async (deviceId, from, to, _, headers) => {\r\n    const query = new URLSearchParams({ deviceId, from, to });\r\n    const response = await fetch(`/api/positions?${query.toString()}`, { headers });\r\n    if (response.ok) {\r\n      setIndex(0);\r\n      setPositions(await response.json());\r\n      setExpanded(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <MainToolbar />\r\n      <Map>\r\n        <ReplayPathMap positions={positions} />\r\n        {index < positions.length\r\n          && <PositionsMap positions={[positions[index]]} />}\r\n      </Map>\r\n      <Container maxWidth=\"sm\" className={classes.controlPanel}>\r\n        {!!positions.length\r\n          && (\r\n          <Paper className={classes.controlContent}>\r\n            <Slider\r\n              max={positions.length - 1}\r\n              step={null}\r\n              marks={positions.map((_, index) => ({ value: index }))}\r\n              value={index}\r\n              onChange={(_, index) => setIndex(index)}\r\n              valueLabelDisplay=\"auto\"\r\n              valueLabelFormat={(i) => (i < positions.length ? formatPosition(positions[i], 'fixTime') : '')}\r\n              ValueLabelComponent={TimeLabel}\r\n            />\r\n          </Paper>\r\n          )}\r\n        <div>\r\n          <Accordion expanded={expanded} onChange={() => setExpanded(!expanded)}>\r\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\r\n              <Typography align=\"center\">\r\n                {t('reportConfigure')}\r\n              </Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails className={classes.configForm}>\r\n              <ReportFilter handleSubmit={handleSubmit} showOnly />\r\n            </AccordionDetails>\r\n          </Accordion>\r\n        </div>\r\n      </Container>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ReplayPage;\r\n"]},"metadata":{},"sourceType":"module"}