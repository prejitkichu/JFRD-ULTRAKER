{"ast":null,"code":"var _jsxFileName = \"D:\\\\Personal_Projects\\\\Vehicle Tracking\\\\Development2.0\\\\JFRD-ULTRAKER\\\\traccar-web\\\\modern\\\\src\\\\settings\\\\MaintenancePage.js\";\nimport React, { useState } from 'react';\nimport { Accordion, AccordionSummary, AccordionDetails, makeStyles, Typography, TextField, FormControl, InputLabel, MenuItem, Select } from '@material-ui/core';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\nimport t from '../common/localization';\nimport { prefixString } from '../common/stringUtils';\nimport EditItemView from '../EditItemView';\nimport EditAttributesView from '../attributes/EditAttributesView';\nimport positionAttributes from '../attributes/positionAttributes';\nimport { useAttributePreference } from '../common/preferences';\nimport { speedFromKnots, speedToKnots, distanceFromMeters, distanceToMeters } from '../common/converter';\nconst useStyles = makeStyles(() => ({\n  details: {\n    flexDirection: 'column'\n  }\n}));\n\nconst MaintenancePage = () => {\n  const classes = useStyles();\n  const [item, setItem] = useState();\n  const [labels, setLabels] = useState({\n    start: '',\n    period: ''\n  });\n  const speedUnit = useAttributePreference('speedUnit');\n  const distanceUnit = useAttributePreference('distanceUnit');\n\n  const convertToList = attributes => {\n    const otherList = [];\n    Object.keys(attributes).forEach(key => {\n      const value = attributes[key];\n\n      if (value.type === 'number') {\n        otherList.push({\n          key,\n          name: value.name,\n          type: value.type\n        });\n      }\n    });\n    return otherList;\n  };\n\n  const onMaintenanceTypeChange = event => {\n    const newValue = event.target.value;\n    setItem({ ...item,\n      type: newValue,\n      start: 0,\n      period: 0\n    });\n    const attribute = positionAttributes[newValue];\n\n    if (attribute && attribute.dataType) {\n      switch (attribute.dataType) {\n        case 'distance':\n          setLabels({ ...labels,\n            start: t(prefixString('shared', distanceUnit)),\n            period: t(prefixString('shared', distanceUnit))\n          });\n          break;\n\n        case 'speed':\n          setLabels({ ...labels,\n            start: t(prefixString('shared', speedUnit)),\n            period: t(prefixString('shared', speedUnit))\n          });\n          break;\n\n        default:\n          break;\n      }\n    }\n  };\n\n  const rawToValue = value => {\n    const attribute = positionAttributes[item.type];\n\n    if (attribute && attribute.dataType) {\n      switch (attribute.dataType) {\n        case 'speed':\n          return speedFromKnots(value, speedUnit);\n\n        case 'distance':\n          return distanceFromMeters(value, distanceUnit);\n\n        default:\n          return value;\n      }\n    }\n\n    return value;\n  };\n\n  const valueToRaw = value => {\n    const attribute = positionAttributes[item.type];\n\n    if (attribute && attribute.dataType) {\n      switch (attribute.dataType) {\n        case 'speed':\n          return speedToKnots(value, speedUnit);\n\n        case 'distance':\n          return distanceToMeters(value, distanceUnit);\n\n        default:\n          return value;\n      }\n    }\n\n    return value;\n  };\n\n  return /*#__PURE__*/React.createElement(EditItemView, {\n    endpoint: \"maintenance\",\n    item: item,\n    setItem: setItem,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 5\n    }\n  }, item && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Accordion, {\n    defaultExpanded: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(AccordionSummary, {\n    expandIcon: /*#__PURE__*/React.createElement(ExpandMoreIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 43\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"subtitle1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 15\n    }\n  }, t('sharedRequired'))), /*#__PURE__*/React.createElement(AccordionDetails, {\n    className: classes.details,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(TextField, {\n    margin: \"normal\",\n    value: item.name || '',\n    onChange: event => setItem({ ...item,\n      name: event.target.value\n    }),\n    label: t('sharedName'),\n    variant: \"filled\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(FormControl, {\n    variant: \"filled\",\n    margin: \"normal\",\n    fullWidth: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(InputLabel, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 17\n    }\n  }, t('sharedType')), /*#__PURE__*/React.createElement(Select, {\n    value: item.type || '',\n    onChange: onMaintenanceTypeChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 17\n    }\n  }, convertToList(positionAttributes).map(_ref => {\n    let {\n      key,\n      name\n    } = _ref;\n    return /*#__PURE__*/React.createElement(MenuItem, {\n      key: key,\n      value: key,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 21\n      }\n    }, name);\n  }))), /*#__PURE__*/React.createElement(TextField, {\n    margin: \"normal\",\n    type: \"number\",\n    value: rawToValue(item.start) || '',\n    onChange: event => setItem({ ...item,\n      start: valueToRaw(event.target.value)\n    }),\n    label: t('maintenanceStart'),\n    variant: \"filled\",\n    InputProps: {\n      endAdornment: /*#__PURE__*/React.createElement(InputAdornment, {\n        position: \"start\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 33\n        }\n      }, labels.start)\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(TextField, {\n    margin: \"normal\",\n    type: \"number\",\n    value: rawToValue(item.period) || '',\n    onChange: event => setItem({ ...item,\n      period: valueToRaw(event.target.value)\n    }),\n    label: t('maintenancePeriod'),\n    variant: \"filled\",\n    InputProps: {\n      endAdornment: /*#__PURE__*/React.createElement(InputAdornment, {\n        position: \"start\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 33\n        }\n      }, labels.period)\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(Accordion, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(AccordionSummary, {\n    expandIcon: /*#__PURE__*/React.createElement(ExpandMoreIcon, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 43\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"subtitle1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 15\n    }\n  }, t('sharedAttributes'))), /*#__PURE__*/React.createElement(AccordionDetails, {\n    className: classes.details,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(EditAttributesView, {\n    attributes: item.attributes,\n    setAttributes: attributes => setItem({ ...item,\n      attributes\n    }),\n    definitions: {},\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 15\n    }\n  })))));\n};\n\nexport default MaintenancePage;","map":{"version":3,"sources":["D:/Personal_Projects/Vehicle Tracking/Development2.0/JFRD-ULTRAKER/traccar-web/modern/src/settings/MaintenancePage.js"],"names":["React","useState","Accordion","AccordionSummary","AccordionDetails","makeStyles","Typography","TextField","FormControl","InputLabel","MenuItem","Select","InputAdornment","ExpandMoreIcon","t","prefixString","EditItemView","EditAttributesView","positionAttributes","useAttributePreference","speedFromKnots","speedToKnots","distanceFromMeters","distanceToMeters","useStyles","details","flexDirection","MaintenancePage","classes","item","setItem","labels","setLabels","start","period","speedUnit","distanceUnit","convertToList","attributes","otherList","Object","keys","forEach","key","value","type","push","name","onMaintenanceTypeChange","event","newValue","target","attribute","dataType","rawToValue","valueToRaw","map","endAdornment"],"mappings":"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","sourcesContent":["import React, { useState } from 'react';\r\nimport {\r\n  Accordion, AccordionSummary, AccordionDetails, makeStyles, Typography, TextField, FormControl, InputLabel, MenuItem, Select,\r\n} from '@material-ui/core';\r\nimport InputAdornment from '@material-ui/core/InputAdornment';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport t from '../common/localization';\r\nimport { prefixString } from '../common/stringUtils';\r\nimport EditItemView from '../EditItemView';\r\nimport EditAttributesView from '../attributes/EditAttributesView';\r\nimport positionAttributes from '../attributes/positionAttributes';\r\nimport { useAttributePreference } from '../common/preferences';\r\nimport {\r\n  speedFromKnots, speedToKnots, distanceFromMeters, distanceToMeters,\r\n} from '../common/converter';\r\n\r\nconst useStyles = makeStyles(() => ({\r\n  details: {\r\n    flexDirection: 'column',\r\n  },\r\n}));\r\n\r\nconst MaintenancePage = () => {\r\n  const classes = useStyles();\r\n  const [item, setItem] = useState();\r\n  const [labels, setLabels] = useState({ start: '', period: '' });\r\n\r\n  const speedUnit = useAttributePreference('speedUnit');\r\n  const distanceUnit = useAttributePreference('distanceUnit');\r\n\r\n  const convertToList = (attributes) => {\r\n    const otherList = [];\r\n    Object.keys(attributes).forEach((key) => {\r\n      const value = attributes[key];\r\n      if (value.type === 'number') {\r\n        otherList.push({ key, name: value.name, type: value.type });\r\n      }\r\n    });\r\n    return otherList;\r\n  };\r\n\r\n  const onMaintenanceTypeChange = (event) => {\r\n    const newValue = event.target.value;\r\n    setItem({\r\n      ...item, type: newValue, start: 0, period: 0,\r\n    });\r\n\r\n    const attribute = positionAttributes[newValue];\r\n    if (attribute && attribute.dataType) {\r\n      switch (attribute.dataType) {\r\n        case 'distance':\r\n          setLabels({ ...labels, start: t(prefixString('shared', distanceUnit)), period: t(prefixString('shared', distanceUnit)) });\r\n          break;\r\n        case 'speed':\r\n          setLabels({ ...labels, start: t(prefixString('shared', speedUnit)), period: t(prefixString('shared', speedUnit)) });\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n  };\r\n\r\n  const rawToValue = (value) => {\r\n    const attribute = positionAttributes[item.type];\r\n    if (attribute && attribute.dataType) {\r\n      switch (attribute.dataType) {\r\n        case 'speed':\r\n          return speedFromKnots(value, speedUnit);\r\n        case 'distance':\r\n          return distanceFromMeters(value, distanceUnit);\r\n        default:\r\n          return value;\r\n      }\r\n    }\r\n    return value;\r\n  };\r\n\r\n  const valueToRaw = (value) => {\r\n    const attribute = positionAttributes[item.type];\r\n    if (attribute && attribute.dataType) {\r\n      switch (attribute.dataType) {\r\n        case 'speed':\r\n          return speedToKnots(value, speedUnit);\r\n        case 'distance':\r\n          return distanceToMeters(value, distanceUnit);\r\n        default:\r\n          return value;\r\n      }\r\n    }\r\n    return value;\r\n  };\r\n\r\n  return (\r\n    <EditItemView endpoint=\"maintenance\" item={item} setItem={setItem}>\r\n      {item\r\n        && (\r\n        <>\r\n          <Accordion defaultExpanded>\r\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\r\n              <Typography variant=\"subtitle1\">\r\n                {t('sharedRequired')}\r\n              </Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails className={classes.details}>\r\n              <TextField\r\n                margin=\"normal\"\r\n                value={item.name || ''}\r\n                onChange={(event) => setItem({ ...item, name: event.target.value })}\r\n                label={t('sharedName')}\r\n                variant=\"filled\"\r\n              />\r\n              <FormControl variant=\"filled\" margin=\"normal\" fullWidth>\r\n                <InputLabel>{t('sharedType')}</InputLabel>\r\n                <Select\r\n                  value={item.type || ''}\r\n                  onChange={onMaintenanceTypeChange}\r\n                >\r\n                  {convertToList(positionAttributes).map(({ key, name }) => (\r\n                    <MenuItem key={key} value={key}>{name}</MenuItem>\r\n                  ))}\r\n                </Select>\r\n              </FormControl>\r\n              <TextField\r\n                margin=\"normal\"\r\n                type=\"number\"\r\n                value={rawToValue(item.start) || ''}\r\n                onChange={(event) => setItem({ ...item, start: valueToRaw(event.target.value) })}\r\n                label={t('maintenanceStart')}\r\n                variant=\"filled\"\r\n                InputProps={{\r\n                  endAdornment: <InputAdornment position=\"start\">{labels.start}</InputAdornment>,\r\n                }}\r\n              />\r\n              <TextField\r\n                margin=\"normal\"\r\n                type=\"number\"\r\n                value={rawToValue(item.period) || ''}\r\n                onChange={(event) => setItem({ ...item, period: valueToRaw(event.target.value) })}\r\n                label={t('maintenancePeriod')}\r\n                variant=\"filled\"\r\n                InputProps={{\r\n                  endAdornment: <InputAdornment position=\"start\">{labels.period}</InputAdornment>,\r\n                }}\r\n              />\r\n            </AccordionDetails>\r\n          </Accordion>\r\n          <Accordion>\r\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\r\n              <Typography variant=\"subtitle1\">\r\n                {t('sharedAttributes')}\r\n              </Typography>\r\n            </AccordionSummary>\r\n            <AccordionDetails className={classes.details}>\r\n              <EditAttributesView\r\n                attributes={item.attributes}\r\n                setAttributes={(attributes) => setItem({ ...item, attributes })}\r\n                definitions={{}}\r\n              />\r\n            </AccordionDetails>\r\n          </Accordion>\r\n        </>\r\n        )}\r\n    </EditItemView>\r\n  );\r\n};\r\n\r\nexport default MaintenancePage;\r\n"]},"metadata":{},"sourceType":"module"}